import * as React from 'react'
import Balancer from 'react-wrap-balancer'
import {
  SubscribeToConvertkitForm,
  redirectUrlBuilder,
} from '@skillrecordings/skill-lesson/convertkit'
import {useRouter} from 'next/router'
import common from '../text/common'
import {type Subscriber} from '@skillrecordings/skill-lesson/schemas/subscriber'
import {track} from '@skillrecordings/skill-lesson/utils/analytics'
import {Button} from '@skillrecordings/ui'
import {cn} from '@skillrecordings/ui/utils/cn'
import {Annotation} from './annotation'
import {useAnimatedSVG} from '@/hooks/use-animated-svg'
import {AnimatedTwirlyArrow} from './scribbles'

type PrimaryNewsletterCtaProps = {
  onSuccess?: () => void
  title?: string
  byline?: string
  actionLabel?: string
  id?: string
  className?: string
  trackProps?: {
    event?: string
    params?: Record<string, string>
  }
}

export const PrimaryNewsletterCta: React.FC<
  React.PropsWithChildren<PrimaryNewsletterCtaProps>
> = ({
  children,
  className,
  id = 'primary-newsletter-cta',
  title = common['primary-newsletter-tittle'],
  byline = common['primary-newsletter-byline'],
  actionLabel = common['primary-newsletter-button-cta-label'],
  trackProps = {event: 'subscribed', params: {}},
  onSuccess,
}) => {
  const router = useRouter()
  const handleOnSuccess = (subscriber: Subscriber | undefined) => {
    if (subscriber) {
      track(trackProps.event as string, trackProps.params)
      const redirectUrl = redirectUrlBuilder(subscriber, '/confirm')
      router.push(redirectUrl)
    }
  }

  const [isHovered, setIsHovered] = React.useState(false)
  const AnimatedArrows = useAnimatedSVG({
    asGroups: true,
    paths: [
      <>
        <path
          d="M78.9101 40.21C71.6301 36.6 64.3301 33 57.0701 29.35C55.5901 28.61 54.1901 27.7 52.8001 26.79C52.3601 26.5 51.7101 26.09 52.0301 25.41C52.4201 24.57 53.1501 24.88 53.7601 25.15C57.7101 26.89 61.6901 28.59 65.6001 30.42C69.7301 32.36 73.8001 34.44 78.2301 36.16C77.5201 35.48 76.7901 34.82 76.1001 34.11C75.6901 33.69 75.2701 33.17 75.6801 32.57C76.1601 31.89 76.8501 32.08 77.4701 32.4C77.9801 32.67 78.4901 32.96 78.9501 33.31C82.7301 36.16 86.5301 38.99 90.2601 41.91C91.1701 42.62 92.7001 43.41 91.8301 44.87C91.0801 46.13 89.9001 44.9 88.9101 44.76C85.0601 44.19 81.2001 43.64 77.3501 43.01C76.1301 42.81 74.9201 42.47 73.7401 42.09C72.9801 41.85 71.8301 41.59 72.0101 40.63C72.2001 39.64 73.3201 39.86 74.1301 39.99C75.6801 40.24 77.2801 40.03 78.9201 40.2L78.9101 40.21Z"
          fill="currentColor"
        />
        <path
          d="M73.76 72.0701C64.1 71.5101 54.94 71.6601 45.86 70.4601C45.08 70.3601 43.78 70.6501 43.83 69.6101C43.87 68.5701 45.18 68.6101 46.07 68.6101C55.54 68.6201 65.02 68.2601 74.46 69.4701C75.51 69.6001 76.59 69.4901 78.13 69.4901C76.26 68.6601 74.75 68.0401 73.29 67.3401C72.69 67.0501 72.06 66.6201 72.51 65.8001C72.85 65.1901 73.44 65.1901 74.04 65.4301C77.52 66.8001 81.01 68.1201 84.45 69.5801C86.02 70.2501 85.41 71.2901 84.31 71.6601C79.43 73.3101 74.51 74.8301 69.6 76.3501C69.14 76.4901 68.53 76.4801 68.26 75.9701C67.89 75.2701 68.51 74.9301 68.94 74.5701C70.23 73.5101 71.86 73.0501 73.76 72.0601V72.0701Z"
          fill="currentColor"
        />
        <path
          d="M86.35 104.45C84.85 104.91 83.37 105.43 81.85 105.81C81.08 106 80.08 106.25 79.8 105.09C79.57 104.17 80.32 103.78 81.04 103.49C83.67 102.43 86.4 101.67 89.17 101.16C90.91 100.84 91.85 101.92 91.2 103.54C89.83 106.95 87.88 110.06 85.19 112.62C84.62 113.16 83.79 113.89 83.01 113.16C82.3 112.5 83.16 111.81 83.44 111.17C83.7 110.58 84.06 110.04 84.1 109.11C77.91 112.74 71.69 116.33 65.53 120.01C62.39 121.88 59.34 123.91 56.22 125.82C55.49 126.27 54.47 127.32 53.86 126.47C53.2 125.57 54.57 125.02 55.23 124.51C63.01 118.51 71.18 113.1 79.9 108.55C82.16 107.37 84.37 106.08 86.6 104.84C86.52 104.71 86.44 104.58 86.36 104.45H86.35Z"
          fill="currentColor"
        />
      </>,
      <>
        <path
          d="M74.6799 72.14C66.4499 72.25 58.3399 71.16 50.1999 71.29C46.4599 71.35 42.7399 71.07 39.0499 70.47C38.3699 70.36 37.2699 70.64 37.3699 69.54C37.4499 68.65 38.4399 68.64 39.1899 68.65C45.4199 68.68 51.6499 68.73 57.8799 68.74C63.6699 68.76 69.4599 68.74 75.1799 68.74C73.6499 68 71.9599 67.2 70.2999 66.35C69.6499 66.02 68.7899 65.63 69.1199 64.72C69.4499 63.82 70.4099 64.06 71.0899 64.19C73.5499 64.65 75.8699 65.56 78.1799 66.49C79.8699 67.17 81.5499 67.89 83.2499 68.56C84.1099 68.9 85.0899 69.14 85.0999 70.28C85.0999 71.27 84.2299 71.64 83.4899 71.98C79.7999 73.7 75.9699 75.07 72.1199 76.39C71.0999 76.74 70.0899 77.14 69.0399 77.35C68.3599 77.48 67.3799 77.75 67.0399 76.92C66.6799 76.04 67.6099 75.6 68.2299 75.29C70.3599 74.19 72.5299 73.19 74.6899 72.15L74.6799 72.14Z"
          fill="currentColor"
        />
        <path
          d="M81.46 106.67C80.86 106.61 80.63 106.54 80.43 106.57C79.6 106.71 78.54 106.96 78.25 106.01C77.9 104.88 79.06 104.49 79.86 104.17C82.94 102.92 86.09 101.87 89.41 101.52C91.31 101.32 92.01 102.36 90.93 103.9C88.4 107.49 85.61 110.89 82.47 113.99C82.19 114.27 81.85 114.67 81.41 114.4C80.88 114.08 81.04 113.52 81.19 113.06C81.41 112.36 81.71 111.68 81.99 110.97C81.09 110.51 80.71 111.26 80.23 111.6C73.09 116.73 65.96 121.88 58.83 127.03C58.76 127.08 58.7 127.14 58.63 127.18C57.59 127.73 56.44 129.18 55.4 127.84C54.34 126.48 55.94 125.65 56.88 124.94C62.64 120.6 68.43 116.28 74.22 111.97C76.53 110.25 78.86 108.57 81.46 106.66V106.67Z"
          fill="currentColor"
        />
        <path
          d="M80.86 39.8199C75.7 37.5699 70.54 35.3199 65.39 33.0499C64.1 32.4799 62.84 31.8399 61.59 31.1899C60.95 30.8599 59.89 30.5199 60.25 29.6999C60.67 28.7399 61.7 29.2599 62.44 29.5499C64.91 30.5199 67.37 31.5199 69.83 32.5299C73.03 33.8499 76.22 35.1899 79.59 36.5899C78.99 34.9799 76.14 34.2199 77.52 32.7599C78.62 31.5899 80.19 33.7199 81.39 34.5699C84.98 37.1199 88.45 39.8199 91.96 42.4699C92.62 42.9699 93.39 43.5099 92.99 44.4999C92.62 45.3999 91.73 45.5599 90.88 45.4699C85.35 44.8999 79.82 44.2699 74.51 42.5099C73.77 42.2699 72.66 42.1099 72.71 41.0799C72.78 39.8599 74.04 39.9899 74.85 39.8099C76.83 39.3699 78.79 40.0899 80.86 39.8399V39.8199Z"
          fill="currentColor"
        />
      </>,
      <>
        <path
          d="M83.9501 41.8099C79.0601 39.3799 74.1401 36.9999 69.3001 34.4699C68.2201 33.8999 65.9001 33.6199 66.7401 31.8699C67.4301 30.4299 69.1401 31.7999 70.2801 32.2499C73.1901 33.4199 76.0301 34.7599 79.0901 35.7799C78.2101 34.8499 77.3201 33.9399 76.4601 32.9899C76.1101 32.5999 75.9301 32.1199 76.3001 31.6399C76.6701 31.1599 77.1901 31.1999 77.6501 31.4299C78.3901 31.8099 79.1301 32.2099 79.7901 32.6999C84.7801 36.4399 89.7601 40.1999 94.7101 43.9899C95.5201 44.6099 96.9101 45.2199 96.3901 46.4499C95.8001 47.8499 94.5201 46.8099 93.5301 46.7099C87.4801 46.1099 81.5301 44.9599 75.6601 43.4499C74.4701 43.1399 73.3201 42.6199 72.1901 42.0899C71.6101 41.8199 70.8501 41.4099 71.0601 40.6399C71.2601 39.9299 72.1301 39.7999 72.7401 39.8699C74.7101 40.1199 76.6801 40.4699 78.6301 40.8599C80.3901 41.2099 82.1201 41.6599 83.8701 42.0599C83.9001 41.9699 83.9301 41.8799 83.9601 41.7799L83.9501 41.8099Z"
          fill="currentColor"
        />
        <path
          d="M74.88 71.8901C65.71 71.4301 56.83 69.7301 47.85 69.8901C47.36 69.8901 46.86 69.7701 46.39 69.6201C46.02 69.5001 45.54 69.3801 45.59 68.8401C45.64 68.3301 46.08 68.2001 46.5 68.1501C48.15 67.9601 49.79 67.6901 51.45 67.6401C56.69 67.4701 61.9 67.9501 67.11 68.4401C70.24 68.7301 73.42 68.4901 77.23 68.4901C74.77 67.8801 72.89 67.4201 71.02 66.9401C70.22 66.7301 69.39 66.5601 68.64 66.2301C67.88 65.9001 67.06 65.4001 67.38 64.3701C67.68 63.4201 68.58 63.6201 69.3 63.7201C72.43 64.1501 75.52 64.8001 78.51 65.8301C80.24 66.4201 81.96 67.0301 83.69 67.6101C84.49 67.8801 85.33 68.0801 85.47 69.1001C85.61 70.1201 84.87 70.5801 84.14 71.0001C80.52 73.0701 76.58 74.4201 72.72 75.9301C70.63 76.7401 68.51 77.4601 66.4 78.2101C65.91 78.3801 65.3 78.4701 65.02 78.0101C64.63 77.3701 65.2 76.9501 65.67 76.6001C67.35 75.3501 69.2 74.4301 71.12 73.6001C72.39 73.0501 73.64 72.4501 74.9 71.8701L74.88 71.8901Z"
          fill="currentColor"
        />
        <path
          d="M80.6701 107.56C79.2001 107.15 77.4501 108.72 77.0401 106.99C76.5901 105.09 78.7301 105.06 79.9401 104.66C82.7701 103.73 85.7401 103.23 88.5101 102.07C89.2301 101.77 89.9801 101.64 90.5401 102.39C91.1101 103.16 90.6801 103.86 90.2001 104.42C87.6801 107.4 85.1501 110.37 82.5701 113.3C81.8801 114.08 80.9601 115.26 79.8901 114.6C78.5701 113.78 80.4401 112.82 80.2001 111.6C76.3101 114.06 72.4901 116.49 68.6601 118.89C67.6801 119.51 66.6701 120.09 65.6301 120.6C65.0801 120.87 64.3301 121.44 63.8401 120.76C63.2301 119.93 64.1101 119.4 64.6301 118.94C65.5501 118.11 66.5201 117.32 67.5401 116.61C71.8301 113.63 76.1401 110.69 80.6901 107.57L80.6701 107.56Z"
          fill="currentColor"
        />
        <path
          d="M62.78 122.35C62.66 123.01 62.27 123.44 61.79 123.78C59.72 125.29 57.64 126.8 55.54 128.27C55.01 128.64 54.28 129.1 53.73 128.53C53.13 127.91 53.78 127.3 54.2 126.85C56.08 124.85 58.24 123.17 60.5 121.63C61.45 120.98 62.39 121 62.77 122.34L62.78 122.35Z"
          fill="currentColor"
        />
      </>,
    ],
  })
  return (
    <section
      id={id}
      aria-label="Newsletter sign-up"
      className={cn('relative flex flex-col items-center', className)}
    >
      {children ? (
        children
      ) : (
        <div className="flex w-full flex-col items-center px-0 pb-8 text-center sm:px-10">
          <h2 className="relative max-w-lg font-serif text-5xl font-bold leading-tight sm:text-5xl lg:text-6xl">
            Supercharge
            <br />
            Your DevRel Team
            <svg
              className="absolute -left-5 -top-16 text-white sm:left-3"
              aria-hidden="true"
              width="92"
              height="72"
              viewBox="0 0 92 72"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M47.8824 36.0327C49.5885 39.7179 52.1476 43.0018 53.2232 46.9789C53.4086 47.6722 53.6312 48.3655 53.7425 49.0588C54.2988 51.8683 52.2219 53.583 49.4403 52.7438C42.5418 50.7005 36.6448 46.7964 30.6735 42.9652C29.8947 42.4908 29.2642 41.6882 27.6694 41.6882C29.9688 44.4613 32.0457 46.9059 34.0856 49.387C38.425 54.5318 42.7272 59.6765 47.0666 64.8577C47.4375 65.2956 47.7713 65.8065 48.068 66.2808C48.9211 67.8133 50.0337 69.4917 48.6985 71.0972C47.3633 72.6662 45.5459 71.8269 43.9882 71.2796C35.4949 68.2876 26.8904 65.478 18.5455 62.1212C12.5372 59.713 6.34329 57.5968 1.29926 53.3277C0.631662 52.7439 -0.517964 52.379 0.260894 51.1749C0.965576 50.0803 2.04111 50.2992 3.00541 50.737C6.78844 52.5249 10.6085 54.24 14.5399 55.6995C23.9233 59.2023 33.3438 62.7051 43.1352 66.3539C42.3563 64.2376 40.9841 62.9969 39.9085 61.6833C33.9373 54.4953 27.8548 47.4167 21.8464 40.2651C20.0291 38.0759 18.2488 35.8501 16.4686 33.6244C15.5784 32.4932 15.4671 31.2163 16.3572 30.0852C17.2102 29.027 18.3229 29.4284 19.3985 29.8297C22.4397 30.9244 24.7764 33.1137 27.3355 34.9016C33.7518 39.426 40.3163 43.7315 47.4003 47.1613C48.0308 47.4532 48.7727 48.2559 49.4032 47.5992C49.9224 47.0519 49.2547 46.2857 49.0322 45.6654C46.3618 39.0247 41.8742 33.442 38.3137 27.2756C36.5335 24.2106 34.5678 21.2187 32.7505 18.1902C32.1571 17.1685 31.2668 15.8914 32.5648 14.9062C33.8259 13.9575 35.2353 14.6508 36.1254 15.636C40.2423 20.1605 44.2479 24.8309 48.2906 29.3919C52.8154 34.5366 57.0063 39.9732 62.1616 44.5706C62.5696 44.9355 62.9034 45.6652 63.571 45.4463C64.3499 45.1909 63.8676 44.4247 63.9047 43.9139C64.6094 37.3461 63.4969 30.8514 63.126 24.3201C62.9034 20.3429 62.2358 16.3293 62.5696 12.4251C62.7921 9.87095 62.7921 7.17104 63.5339 4.61691C63.7564 3.85067 63.979 2.86532 65.1658 2.82883C66.5381 2.82883 67.391 3.52216 67.7989 4.72625C69.1712 8.55745 70.0243 12.5347 71.0627 16.4389C71.5078 18.0808 71.5449 19.8321 72.4721 21.547C73.8444 19.7591 73.3252 17.7887 73.6961 16.0373C74.7346 11.2939 75.9956 6.66 78.7772 2.57339C81.1509 -0.92942 84.6743 -0.856231 86.8996 2.79253C88.9024 6.1129 89.3104 9.87101 89.7555 13.6292C90.7198 21.766 90.015 29.9392 90.3117 38.076C90.3488 39.1341 89.6814 40.6665 91.647 40.9949C92.0921 41.0679 92.055 41.7612 91.8696 42.1626C91.4987 42.9288 91.6098 43.7314 91.5357 44.5341C91.3502 46.1031 90.8682 47.818 89.0879 48.0005C87.2335 48.1829 86.7142 46.4317 86.232 44.9722C85.4903 42.7099 85.787 40.3747 85.7499 38.076C85.6757 33.5515 85.7499 29.0269 85.7499 24.5025C85.787 18.5185 85.4532 12.5347 84.4147 6.62368C84.3035 6.07637 84.118 5.52901 83.9326 4.98169C83.71 4.32492 83.3021 3.81414 82.5974 3.66819C81.7815 3.52224 81.4847 4.17894 81.1138 4.72625C78.5547 8.33852 77.5532 12.4617 76.8485 16.6943C76.0326 21.7296 76.0327 26.8378 76.0327 31.9096C76.0327 32.3474 76.0327 32.7852 76.0327 33.2231C76.1069 34.9015 75.2909 36.2151 73.6961 36.4705C72.1013 36.7624 71.5079 35.3028 71.137 34.0622C70.2098 30.9972 69.2825 27.8959 68.5036 24.7944C67.5764 21.0727 66.7976 17.3144 65.7962 13.5927C65.7962 16.0009 65.6479 18.4455 65.7962 20.8537C66.13 25.3417 66.501 29.7933 67.0573 34.2448C67.4653 37.4557 67.3911 40.6302 67.5024 43.8411C67.5395 45.1181 67.2426 46.3222 66.9088 47.4533C66.2783 49.679 64.0901 50.5912 62.0503 49.4601C57.8593 47.1249 54.781 43.5855 51.7398 40.0097C50.5529 38.5867 49.6256 36.9083 47.8824 35.9961C47.8824 35.8137 47.8455 35.6312 47.8084 35.4487C47.7342 35.4487 47.66 35.5218 47.5488 35.5583C47.66 35.7043 47.7712 35.8502 47.9195 35.9961L47.8824 36.0327Z"
                fill="currentColor"
              />
            </svg>
            <svg
              className="absolute -right-56 -top-1/2 hidden w-64 rotate-12 text-white sm:block"
              aria-hidden="true"
              viewBox="0 0 150 150"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <AnimatedTwirlyArrow />
            </svg>
          </h2>
          <h3 className="pt-4 text-center text-lg">{byline}</h3>
        </div>
      )}
      <div className="relative mx-auto w-full max-w-lg">
        <svg
          className="absolute -bottom-10 -left-28 text-white"
          aria-hidden="true"
          width="150"
          height="150"
          viewBox="0 0 150 150"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
        >
          <AnimatedArrows />
        </svg>

        <SubscribeToConvertkitForm
          onSuccess={onSuccess ? onSuccess : handleOnSuccess}
          actionLabel={actionLabel}
          submitButtonElem={
            <Button
              data-sr-button=""
              onMouseOver={() => {
                setIsHovered(true)
              }}
            >
              <Annotation
                options={{
                  show: isHovered,
                  type: 'underline',
                }}
              >
                {common['primary-newsletter-button-cta-label']}
              </Annotation>
            </Button>
          }
        />
      </div>
      <p data-nospam="" className="mt-10 w-full text-center text-sm opacity-75">
        <Balancer>I respect your privacy. Unsubscribe at any time.</Balancer>
      </p>
    </section>
  )
}
